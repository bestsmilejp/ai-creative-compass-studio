# 将来実装予定の機能

## キーワード・記事管理の改善

### キーワードごとの記事数上限と通知機能

**概要**
- サイト管理者がキーワードごとの記事数上限を設定できる
- 指定記事数に達した場合、メールで通知
- 新しいキーワード登録を促す

**検討事項**
1. `site_keywords` テーブルに `max_articles` カラム追加
2. 記事生成時に現在の記事数をチェック
3. 上限到達時の処理:
   - メール通知（SendGrid/Resend等）
   - ダッシュボードにアラート表示
   - キーワードの `is_active` を自動で `false` に変更

**代替案: 複数キーワードのスケジュール設定**
- 1回の実行で複数キーワードから記事生成
- キーワードのローテーション機能
- 曜日ごとに異なるキーワードを設定

**UI案**
```
キーワード設定画面:
[健康的な朝食レシピ] 上限: 10記事 / 現在: 5記事 [編集]
[睡眠の質を上げる方法] 上限: 5記事 / 現在: 5記事 ⚠️上限到達
```

**優先度**: 中
**追加日**: 2026-01-11

---

---

## n8nワークフローのエラーハンドリング

### エラー発生時の自動処理

**概要**
- 各ノードでエラー発生時にジョブステータスを「failed」に更新
- エラーメッセージをDBに記録
- 管理者へのエラー通知（メール/Slack等）

**実装方法**
1. 各ノードの「Continue On Fail」を OFF に設定
2. Error Branch を `ジョブ失敗` ノードに接続
3. または Error Workflow を別途作成

**ジョブ失敗ノード設定**
```
Method: PATCH
URL: /api/n8n/jobs/{jobId}
Body: {
  "status": "failed",
  "errorMessage": "エラー内容"
}
```

**検討事項**
- リトライ機能（一定回数まで自動リトライ）
- エラー種別による処理分岐（API制限/タイムアウト/認証エラー等）
- Slack/メール通知連携

**優先度**: 中
**追加日**: 2026-01-11

---

## WordPress認証情報のセキュリティ強化

### Firebase Secret Managerでの認証情報管理

**概要**
- WordPress認証情報をSupabaseではなくFirebase Secret Managerで管理
- サイトごとの認証情報をJSON形式で保存
- API経由でBase64エンコード済み認証ヘッダーを返却

**実装方法**
1. Firebase Secretに`WP_CREDENTIALS`を設定（JSON形式）
   ```json
   {
     "site-uuid-1": { "username": "user1", "password": "xxxx" },
     "site-uuid-2": { "username": "user2", "password": "yyyy" }
   }
   ```
2. `/api/n8n/sites/[siteId]/wp-auth` エンドポイントを作成
3. sitesテーブルから`wp_username`, `wp_app_password`カラムを削除
4. n8nワークフローで新しいエンドポイントを使用

**メリット**
- 認証情報がDBに保存されない
- Firebase Secret Managerで一元管理
- アクセスログの監査が可能

**優先度**: 低
**追加日**: 2026-01-11

---

## その他の検討機能

（今後追加予定）
